{"id": "Q1", "question": "How many total users are there?", "expected_sql": "SELECT COUNT(*) as total_users FROM users;"}
{"id": "Q2", "question": "What is the total number of products?", "expected_sql": "SELECT COUNT(*) as total_products FROM products;"}
{"id": "Q3", "question": "List all active sellers", "expected_sql": "SELECT seller_name, email, city FROM sellers WHERE is_active = 1;"}
{"id": "Q4", "question": "Show all categories", "expected_sql": "SELECT category_name, description FROM categories WHERE parent_category_id IS NULL;"}
{"id": "Q5", "question": "How many orders were placed?", "expected_sql": "SELECT COUNT(*) as total_orders FROM orders;"}
{"id": "Q6", "question": "What is the total revenue?", "expected_sql": "SELECT SUM(final_amount) as total_revenue FROM orders WHERE payment_status = 'Paid';"}
{"id": "Q7", "question": "List all products from Samsung", "expected_sql": "SELECT product_name, selling_price FROM products WHERE brand = 'Samsung';"}
{"id": "Q8", "question": "Show all products in electronics category", "expected_sql": "SELECT p.product_name, p.selling_price\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE c.category_name = 'Electronics';"}
{"id": "Q9", "question": "How many users are female?", "expected_sql": "SELECT COUNT(*) as female_users FROM users WHERE gender = 'Female';"}
{"id": "Q10", "question": "List all products under 1000 rupees", "expected_sql": "SELECT product_name, selling_price FROM products WHERE selling_price < 1000 ORDER BY selling_price;"}
{"id": "Q11", "question": "Show products with discount greater than 20%", "expected_sql": "SELECT product_name, original_price, selling_price, discount_percentage\nFROM products\nWHERE discount_percentage > 20;"}
{"id": "Q12", "question": "How many orders are delivered?", "expected_sql": "SELECT COUNT(*) as delivered_orders FROM orders WHERE order_status = 'Delivered';"}
{"id": "Q13", "question": "List all users from Delhi", "expected_sql": "SELECT first_name, last_name, email FROM users u\nJOIN addresses a ON u.user_id = a.user_id\nWHERE a.state = 'Delhi';"}
{"id": "Q14", "question": "Show all coupons", "expected_sql": "SELECT coupon_code, coupon_name, discount_value FROM coupons WHERE is_active = 1;"}
{"id": "Q15", "question": "How many products are featured?", "expected_sql": "SELECT COUNT(*) as featured_products FROM products WHERE is_featured = 1;"}
{"id": "Q16", "question": "List all books", "expected_sql": "SELECT product_name, selling_price FROM products WHERE category_id = 4;"}
{"id": "Q17", "question": "Show all orders with COD payment", "expected_sql": "SELECT order_number, final_amount, order_date FROM orders WHERE payment_method = 'COD';"}
{"id": "Q18", "question": "How many sellers are verified?", "expected_sql": "SELECT COUNT(*) as verified_sellers FROM sellers WHERE is_verified = 1;"}
{"id": "Q19", "question": "List products with warranty", "expected_sql": "SELECT product_name, warranty_period FROM products WHERE warranty_period IS NOT NULL;"}
{"id": "Q20", "question": "Show users who joined in 2024", "expected_sql": "SELECT first_name, last_name, email, created_at\nFROM users\nWHERE YEAR(created_at) = 2024;"}
{"id": "Q21", "question": "How many products are out of stock?", "expected_sql": "SELECT COUNT(*) as out_of_stock FROM products WHERE stock_quantity = 0;"}
{"id": "Q22", "question": "List all fashion products", "expected_sql": "SELECT p.product_name, p.selling_price\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nWHERE c.category_name = 'Fashion' OR c.parent_category_id = 2;"}
{"id": "Q23", "question": "Show pending orders", "expected_sql": "SELECT order_number, user_id, final_amount FROM orders WHERE order_status = 'Placed';"}
{"id": "Q24", "question": "How many reviews are there?", "expected_sql": "SELECT COUNT(*) as total_reviews FROM reviews WHERE is_active = 1;"}
{"id": "Q25", "question": "List all cities where we deliver", "expected_sql": "SELECT DISTINCT city, state FROM addresses ORDER BY state, city;\n-- ====================\n-- CATEGORY 2: INTERMEDIATE QUERIES (Questions 26-50)\n-- JOINs, GROUP BY, HAVING, Aggregations\n-- ===================="}
{"id": "Q26", "question": "What is the average order value?", "expected_sql": "SELECT ROUND(AVG(final_amount), 2) as avg_order_value\nFROM orders\nWHERE payment_status = 'Paid';"}
{"id": "Q27", "question": "Show total sales by seller", "expected_sql": "SELECT s.seller_name, SUM(o.final_amount) as total_sales\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name\nORDER BY total_sales DESC;"}
{"id": "Q28", "question": "How many orders per month?", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    COUNT(*) as order_count\nFROM orders\nGROUP BY month\nORDER BY month;"}
{"id": "Q29", "question": "What are the top 5 selling products?", "expected_sql": "SELECT\n    p.product_name,\n    COUNT(oi.order_item_id) as times_sold,\n    SUM(oi.quantity) as total_quantity\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY p.product_id, p.product_name\nORDER BY times_sold DESC\nLIMIT 5;"}
{"id": "Q30", "question": "Show revenue by category", "expected_sql": "SELECT\n    c.category_name,\n    SUM(oi.total_price) as category_revenue\nFROM categories c\nJOIN products p ON c.category_id = p.category_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY c.category_id, c.category_name\nORDER BY category_revenue DESC;"}
{"id": "Q31", "question": "How many orders per user?", "expected_sql": "SELECT\n    u.first_name,\n    u.last_name,\n    COUNT(o.order_id) as order_count\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id\nGROUP BY u.user_id, u.first_name, u.last_name\nHAVING order_count > 0\nORDER BY order_count DESC;"}
{"id": "Q32", "question": "What is the average rating per product?", "expected_sql": "SELECT\n    p.product_name,\n    ROUND(AVG(r.rating), 2) as avg_rating,\n    COUNT(r.review_id) as review_count\nFROM products p\nJOIN reviews r ON p.product_id = r.product_id\nWHERE r.is_active = 1\nGROUP BY p.product_id, p.product_name\nORDER BY avg_rating DESC;"}
{"id": "Q33", "question": "Show total discount given per month", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    SUM(discount_amount) as total_discount\nFROM orders\nGROUP BY month\nORDER BY month;"}
{"id": "Q34", "question": "Which payment method is most used?", "expected_sql": "SELECT\n    payment_method,\n    COUNT(*) as usage_count,\n    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM orders), 2) as percentage\nFROM orders\nGROUP BY payment_method\nORDER BY usage_count DESC;"}
{"id": "Q35", "question": "Show sellers with more than 10 orders", "expected_sql": "SELECT\n    s.seller_name,\n    COUNT(DISTINCT o.order_id) as order_count\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nGROUP BY s.seller_id, s.seller_name\nHAVING order_count > 10\nORDER BY order_count DESC;"}
{"id": "Q36", "question": "What is the total tax collected?", "expected_sql": "SELECT SUM(tax_amount) as total_tax FROM orders WHERE payment_status = 'Paid';"}
{"id": "Q37", "question": "Show products by price range", "expected_sql": "SELECT\n    CASE\n        WHEN selling_price < 1000 THEN 'Under 1000'\n        WHEN selling_price BETWEEN 1000 AND 10000 THEN '1000-10000'\n        WHEN selling_price BETWEEN 10000 AND 50000 THEN '10000-50000'\n        ELSE 'Above 50000'\n    END as price_range,\n    COUNT(*) as product_count\nFROM products\nGROUP BY price_range\nORDER BY MIN(selling_price);"}
{"id": "Q38", "question": "How many orders per state?", "expected_sql": "SELECT\n    a.state,\n    COUNT(DISTINCT o.order_id) as order_count\nFROM addresses a\nJOIN orders o ON a.address_id = o.shipping_address_id\nGROUP BY a.state\nORDER BY order_count DESC;"}
{"id": "Q39", "question": "Show average delivery time", "expected_sql": "SELECT\n    ROUND(AVG(DATEDIFF(actual_delivery_date, order_date)), 2) as avg_delivery_days\nFROM orders\nWHERE actual_delivery_date IS NOT NULL;"}
{"id": "Q40", "question": "What is revenue per seller per month?", "expected_sql": "SELECT\n    s.seller_name,\n    DATE_FORMAT(o.order_date, '%Y-%m') as month,\n    SUM(oi.total_price) as monthly_revenue\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name, month\nORDER BY s.seller_name, month;"}
{"id": "Q41", "question": "Which brands are most popular?", "expected_sql": "SELECT\n    brand,\n    COUNT(DISTINCT p.product_id) as product_count,\n    SUM(oi.quantity) as units_sold\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY brand\nORDER BY units_sold DESC;"}
{"id": "Q42", "question": "Show coupon usage statistics", "expected_sql": "SELECT\n    c.coupon_code,\n    c.used_count,\n    SUM(uc.discount_applied) as total_discount_given\nFROM coupons c\nLEFT JOIN user_coupons uc ON c.coupon_id = uc.coupon_id\nGROUP BY c.coupon_id, c.coupon_code, c.used_count\nORDER BY total_discount_given DESC;"}
{"id": "Q43", "question": "How many users per city?", "expected_sql": "SELECT\n    a.city,\n    a.state,\n    COUNT(DISTINCT a.user_id) as user_count\nFROM addresses a\nGROUP BY a.city, a.state\nORDER BY user_count DESC;"}
{"id": "Q44", "question": "What is the order cancellation rate?", "expected_sql": "SELECT\n    COUNT(CASE WHEN order_status = 'Cancelled' THEN 1 END) as cancelled_orders,\n    COUNT(*) as total_orders,\n    ROUND(COUNT(CASE WHEN order_status = 'Cancelled' THEN 1 END) * 100.0 / COUNT(*), 2) as cancellation_rate\nFROM orders;"}
{"id": "Q45", "question": "Show products with low stock", "expected_sql": "SELECT\n    product_name,\n    stock_quantity,\n    seller_id\nFROM products\nWHERE stock_quantity < 50 AND is_active = 1\nORDER BY stock_quantity;"}
{"id": "Q46", "question": "What is the gender distribution of buyers?", "expected_sql": "SELECT\n    u.gender,\n    COUNT(DISTINCT o.order_id) as order_count\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nGROUP BY u.gender;"}
{"id": "Q47", "question": "Show weekly order trends", "expected_sql": "SELECT\n    YEARWEEK(order_date) as week,\n    COUNT(*) as orders,\n    SUM(final_amount) as revenue\nFROM orders\nWHERE order_status = 'Delivered'\nGROUP BY week\nORDER BY week;"}
{"id": "Q48", "question": "Which products have the most reviews?", "expected_sql": "SELECT\n    p.product_name,\n    COUNT(r.review_id) as review_count,\n    ROUND(AVG(r.rating), 2) as avg_rating\nFROM products p\nJOIN reviews r ON p.product_id = r.product_id\nWHERE r.is_active = 1\nGROUP BY p.product_id, p.product_name\nORDER BY review_count DESC\nLIMIT 10;"}
{"id": "Q49", "question": "Show revenue by payment method", "expected_sql": "SELECT\n    payment_method,\n    SUM(final_amount) as total_revenue,\n    COUNT(*) as order_count\nFROM orders\nWHERE payment_status = 'Paid'\nGROUP BY payment_method\nORDER BY total_revenue DESC;"}
{"id": "Q50", "question": "What is the average order value by month?", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    ROUND(AVG(final_amount), 2) as avg_order_value\nFROM orders\nWHERE payment_status = 'Paid'\nGROUP BY month\nORDER BY month;\n-- ====================\n-- CATEGORY 3: ADVANCED QUERIES (Questions 51-75)\n-- Subqueries, Window Functions, Complex JOINs\n-- ===================="}
{"id": "Q51", "question": "Who are the top 10 customers by revenue?", "expected_sql": "SELECT\n    u.first_name,\n    u.last_name,\n    u.email,\n    SUM(o.final_amount) as total_spent,\n    COUNT(o.order_id) as order_count\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name, u.email\nORDER BY total_spent DESC\nLIMIT 10;"}
{"id": "Q52", "question": "Show products that have never been ordered", "expected_sql": "SELECT\n    p.product_name,\n    p.selling_price,\n    s.seller_name\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nJOIN sellers s ON p.seller_id = s.seller_id\nWHERE oi.order_item_id IS NULL;"}
{"id": "Q53", "question": "What is the month-over-month growth rate?", "expected_sql": "SELECT\n    month,\n    revenue,\n    prev_month_revenue,\n    ROUND((revenue - prev_month_revenue) * 100.0 / prev_month_revenue, 2) as growth_rate\nFROM (\n    SELECT\n        DATE_FORMAT(order_date, '%Y-%m') as month,\n        SUM(final_amount) as revenue,\n        LAG(SUM(final_amount)) OVER (ORDER BY DATE_FORMAT(order_date, '%Y-%m')) as prev_month_revenue\n    FROM orders\n    WHERE payment_status = 'Paid'\n    GROUP BY month\n) as monthly_data\nWHERE prev_month_revenue IS NOT NULL;"}
{"id": "Q54", "question": "Show products priced above category average", "expected_sql": "SELECT\n    p.product_name,\n    p.selling_price,\n    c.category_name,\n    ROUND(AVG(p2.selling_price) OVER (PARTITION BY p.category_id), 2) as category_avg\nFROM products p\nJOIN categories c ON p.category_id = c.category_id\nJOIN products p2 ON p.category_id = p2.category_id\nWHERE p.selling_price > (\n    SELECT AVG(selling_price)\n    FROM products\n    WHERE category_id = p.category_id\n)\nGROUP BY p.product_id, p.product_name, p.selling_price, c.category_name, p.category_id;"}
{"id": "Q55", "question": "Find users who haven't ordered in last 30 days", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    u.email,\n    MAX(o.order_date) as last_order_date\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id\nGROUP BY u.user_id, u.first_name, u.last_name, u.email\nHAVING MAX(o.order_date) < DATE_SUB(NOW(), INTERVAL 30 DAY) OR MAX(o.order_date) IS NULL;"}
{"id": "Q56", "question": "Show seller performance comparison", "expected_sql": "SELECT\n    s.seller_name,\n    COUNT(DISTINCT o.order_id) as total_orders,\n    SUM(oi.total_price) as total_revenue,\n    ROUND(AVG(oi.total_price), 2) as avg_sale,\n    RANK() OVER (ORDER BY SUM(oi.total_price) DESC) as revenue_rank\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name;"}
{"id": "Q57", "question": "What is the cart abandonment rate?", "expected_sql": "SELECT\n    COUNT(DISTINCT c.user_id) as users_with_cart,\n    COUNT(DISTINCT o.user_id) as users_with_orders,\n    COUNT(DISTINCT c.user_id) - COUNT(DISTINCT o.user_id) as abandoned_users,\n    ROUND((COUNT(DISTINCT c.user_id) - COUNT(DISTINCT o.user_id)) * 100.0 / COUNT(DISTINCT c.user_id), 2) as abandonment_rate\nFROM cart c\nLEFT JOIN orders o ON c.user_id = o.user_id AND o.order_date > c.added_at;"}
{"id": "Q58", "question": "Show products with best discount offers", "expected_sql": "SELECT\n    p.product_name,\n    p.original_price,\n    p.selling_price,\n    p.discount_percentage,\n    (p.original_price - p.selling_price) as discount_amount,\n    s.seller_name\nFROM products p\nJOIN sellers s ON p.seller_id = s.seller_id\nWHERE p.discount_percentage > 0\nORDER BY discount_amount DESC\nLIMIT 10;"}
{"id": "Q59", "question": "Find repeat customers", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    COUNT(o.order_id) as order_count,\n    SUM(o.final_amount) as total_spent\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name\nHAVING order_count > 1\nORDER BY order_count DESC;"}
{"id": "Q60", "question": "Show products with highest revenue per unit", "expected_sql": "SELECT\n    p.product_name,\n    SUM(oi.quantity) as units_sold,\n    SUM(oi.total_price) as total_revenue,\n    ROUND(SUM(oi.total_price) / SUM(oi.quantity), 2) as revenue_per_unit\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY p.product_id, p.product_name\nORDER BY revenue_per_unit DESC\nLIMIT 10;"}
{"id": "Q61", "question": "What is the customer lifetime value?", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    COUNT(o.order_id) as total_orders,\n    SUM(o.final_amount) as lifetime_value,\n    ROUND(AVG(o.final_amount), 2) as avg_order_value,\n    DATEDIFF(MAX(o.order_date), MIN(o.order_date)) as customer_lifespan_days\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name\nORDER BY lifetime_value DESC\nLIMIT 20;"}
{"id": "Q62", "question": "Show order status distribution by month", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    order_status,\n    COUNT(*) as status_count\nFROM orders\nGROUP BY month, order_status\nORDER BY month, order_status;"}
{"id": "Q63", "question": "Find products frequently bought together", "expected_sql": "SELECT\n    oi1.product_id as product1,\n    p1.product_name as product1_name,\n    oi2.product_id as product2,\n    p2.product_name as product2_name,\n    COUNT(*) as times_together\nFROM order_items oi1\nJOIN order_items oi2 ON oi1.order_id = oi2.order_id AND oi1.product_id < oi2.product_id\nJOIN products p1 ON oi1.product_id = p1.product_id\nJOIN products p2 ON oi2.product_id = p2.product_id\nGROUP BY oi1.product_id, p1.product_name, oi2.product_id, p2.product_name\nHAVING times_together > 1\nORDER BY times_together DESC;"}
{"id": "Q64", "question": "Calculate revenue contribution by category", "expected_sql": "SELECT\n    c.category_name,\n    SUM(oi.total_price) as category_revenue,\n    ROUND(SUM(oi.total_price) * 100.0 / (\n        SELECT SUM(total_price)\n        FROM order_items oi2\n        JOIN orders o2 ON oi2.order_id = o2.order_id\n        WHERE o2.order_status = 'Delivered'\n    ), 2) as revenue_percentage\nFROM categories c\nJOIN products p ON c.category_id = p.category_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY c.category_id, c.category_name\nORDER BY category_revenue DESC;"}
{"id": "Q65", "question": "Show user engagement metrics", "expected_sql": "SELECT\n    DATE_FORMAT(u.created_at, '%Y-%m') as signup_month,\n    COUNT(DISTINCT u.user_id) as new_users,\n    COUNT(DISTINCT o.user_id) as active_users,\n    ROUND(COUNT(DISTINCT o.user_id) * 100.0 / COUNT(DISTINCT u.user_id), 2) as activation_rate\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id AND MONTH(o.order_date) = MONTH(u.created_at) AND YEAR(o.order_date) = YEAR(u.created_at)\nGROUP BY signup_month\nORDER BY signup_month;"}
{"id": "Q66", "question": "Find high-value low-volume products", "expected_sql": "SELECT\n    p.product_name,\n    p.selling_price,\n    COUNT(oi.order_item_id) as times_ordered,\n    SUM(oi.total_price) as total_revenue\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY p.product_id, p.product_name, p.selling_price\nHAVING times_ordered < 10 AND p.selling_price > 50000\nORDER BY total_revenue DESC;"}
{"id": "Q67", "question": "Show seasonal trends by category", "expected_sql": "SELECT\n    c.category_name,\n    MONTH(o.order_date) as month,\n    COUNT(o.order_id) as orders,\n    SUM(oi.total_price) as revenue\nFROM categories c\nJOIN products p ON c.category_id = p.category_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY c.category_id, c.category_name, month\nORDER BY c.category_name, month;"}
{"id": "Q68", "question": "Calculate customer retention rate", "expected_sql": "SELECT\n    first_order_month,\n    COUNT(DISTINCT user_id) as cohort_size,\n    COUNT(DISTINCT CASE WHEN months_since_first = 1 THEN user_id END) as retained_month_1,\n    ROUND(COUNT(DISTINCT CASE WHEN months_since_first = 1 THEN user_id END) * 100.0 / COUNT(DISTINCT user_id), 2) as retention_rate\nFROM (\n    SELECT\n        u.user_id,\n        DATE_FORMAT(MIN(o.order_date), '%Y-%m') as first_order_month,\n        PERIOD_DIFF(DATE_FORMAT(o.order_date, '%Y%m'), DATE_FORMAT(MIN(o.order_date) OVER (PARTITION BY u.user_id), '%Y%m')) as months_since_first\n    FROM users u\n    JOIN orders o ON u.user_id = o.user_id\n    WHERE o.payment_status = 'Paid'\n) as cohort_data\nGROUP BY first_order_month\nORDER BY first_order_month;"}
{"id": "Q69", "question": "Show inventory turnover by seller", "expected_sql": "SELECT\n    s.seller_name,\n    SUM(p.stock_quantity) as current_stock,\n    SUM(oi.quantity) as units_sold,\n    ROUND(SUM(oi.quantity) / SUM(p.stock_quantity), 2) as turnover_ratio\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name\nHAVING current_stock > 0\nORDER BY turnover_ratio DESC;"}
{"id": "Q70", "question": "Find products with declining sales", "expected_sql": "SELECT\n    p.product_name,\n    DATE_FORMAT(o.order_date, '%Y-%m') as month,\n    COUNT(oi.order_item_id) as monthly_orders,\n    LAG(COUNT(oi.order_item_id)) OVER (PARTITION BY p.product_id ORDER BY DATE_FORMAT(o.order_date, '%Y-%m')) as prev_month_orders\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY p.product_id, p.product_name, month\nHAVING prev_month_orders IS NOT NULL AND monthly_orders < prev_month_orders\nORDER BY p.product_name, month;"}
{"id": "Q71", "question": "Show average basket size by user segment", "expected_sql": "SELECT\n    CASE\n        WHEN order_count = 1 THEN 'One-time'\n        WHEN order_count BETWEEN 2 AND 5 THEN 'Regular'\n        ELSE 'Loyal'\n    END as customer_segment,\n    COUNT(DISTINCT user_id) as customer_count,\n    ROUND(AVG(avg_order_value), 2) as avg_basket_size\nFROM (\n    SELECT\n        u.user_id,\n        COUNT(o.order_id) as order_count,\n        AVG(o.final_amount) as avg_order_value\n    FROM users u\n    JOIN orders o ON u.user_id = o.user_id\n    WHERE o.payment_status = 'Paid'\n    GROUP BY u.user_id\n) as user_segments\nGROUP BY customer_segment;"}
{"id": "Q72", "question": "Find cross-selling opportunities", "expected_sql": "SELECT\n    p1.product_name as anchor_product,\n    p2.product_name as recommended_product,\n    COUNT(*) as co_occurrence,\n    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(DISTINCT order_id) FROM order_items WHERE product_id = p1.product_id), 2) as recommendation_strength\nFROM order_items oi1\nJOIN order_items oi2 ON oi1.order_id = oi2.order_id AND oi1.product_id != oi2.product_id\nJOIN products p1 ON oi1.product_id = p1.product_id\nJOIN products p2 ON oi2.product_id = p2.product_id\nGROUP BY p1.product_id, p1.product_name, p2.product_id, p2.product_name\nHAVING co_occurrence >= 2\nORDER BY co_occurrence DESC\nLIMIT 20;"}
{"id": "Q73", "question": "Calculate customer acquisition cost efficiency", "expected_sql": "SELECT\n    DATE_FORMAT(u.created_at, '%Y-%m') as signup_month,\n    COUNT(DISTINCT u.user_id) as new_customers,\n    COUNT(DISTINCT o.order_id) as orders_from_new_customers,\n    SUM(o.final_amount) as revenue_from_new_customers,\n    ROUND(SUM(o.final_amount) / COUNT(DISTINCT u.user_id), 2) as revenue_per_new_customer\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id AND DATE_FORMAT(o.order_date, '%Y-%m') = DATE_FORMAT(u.created_at, '%Y-%m')\nWHERE o.payment_status = 'Paid' OR o.order_id IS NULL\nGROUP BY signup_month\nORDER BY signup_month;"}
{"id": "Q74", "question": "Show product performance matrix", "expected_sql": "SELECT\n    p.product_name,\n    COUNT(oi.order_item_id) as order_frequency,\n    SUM(oi.total_price) as total_revenue,\n    ROUND(AVG(r.rating), 2) as avg_rating,\n    CASE\n        WHEN COUNT(oi.order_item_id) > 10 AND SUM(oi.total_price) > 100000 THEN 'Star'\n        WHEN COUNT(oi.order_item_id) > 10 THEN 'High Volume'\n        WHEN SUM(oi.total_price) > 100000 THEN 'High Value'\n        ELSE 'Regular'\n    END as product_category\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nLEFT JOIN reviews r ON p.product_id = r.product_id\nGROUP BY p.product_id, p.product_name\nORDER BY total_revenue DESC;"}
{"id": "Q75", "question": "Analyze shipping performance by state", "expected_sql": "SELECT\n    a.state,\n    COUNT(o.order_id) as total_orders,\n    ROUND(AVG(DATEDIFF(o.actual_delivery_date, o.order_date)), 2) as avg_delivery_days,\n    COUNT(CASE WHEN DATEDIFF(o.actual_delivery_date, o.estimated_delivery_date) > 0 THEN 1 END) as delayed_deliveries,\n    ROUND(COUNT(CASE WHEN DATEDIFF(o.actual_delivery_date, o.estimated_delivery_date) > 0 THEN 1 END) * 100.0 / COUNT(o.order_id), 2) as delay_rate\nFROM addresses a\nJOIN orders o ON a.address_id = o.shipping_address_id\nWHERE o.actual_delivery_date IS NOT NULL\nGROUP BY a.state\nORDER BY delay_rate DESC;\n-- ====================\n-- CATEGORY 4: COMPLEX BUSINESS QUERIES (Questions 76-100)\n-- Multi-level subqueries, Complex analytics, Business metrics\n-- ===================="}
{"id": "Q76", "question": "RFM Analysis - Recency, Frequency, Monetary", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    DATEDIFF(NOW(), MAX(o.order_date)) as recency_days,\n    COUNT(o.order_id) as frequency,\n    SUM(o.final_amount) as monetary_value,\n    CASE\n        WHEN DATEDIFF(NOW(), MAX(o.order_date)) < 30 THEN 'Active'\n        WHEN DATEDIFF(NOW(), MAX(o.order_date)) < 90 THEN 'At Risk'\n        ELSE 'Dormant'\n    END as customer_status\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name\nORDER BY monetary_value DESC;"}
{"id": "Q77", "question": "Product affinity analysis by category", "expected_sql": "SELECT\n    c1.category_name as category1,\n    c2.category_name as category2,\n    COUNT(DISTINCT oi1.order_id) as orders_with_both,\n    ROUND(AVG(o.final_amount), 2) as avg_order_value\nFROM order_items oi1\nJOIN order_items oi2 ON oi1.order_id = oi2.order_id AND oi1.product_id < oi2.product_id\nJOIN products p1 ON oi1.product_id = p1.product_id\nJOIN products p2 ON oi2.product_id = p2.product_id\nJOIN categories c1 ON p1.category_id = c1.category_id\nJOIN categories c2 ON p2.category_id = c2.category_id\nJOIN orders o ON oi1.order_id = o.order_id\nWHERE o.order_status = 'Delivered' AND c1.category_id != c2.category_id\nGROUP BY c1.category_id, c1.category_name, c2.category_id, c2.category_name\nHAVING orders_with_both > 2\nORDER BY orders_with_both DESC;"}
{"id": "Q78", "question": "Customer churn prediction indicators", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    MAX(o.order_date) as last_order_date,\n    DATEDIFF(NOW(), MAX(o.order_date)) as days_since_last_order,\n    COUNT(o.order_id) as total_orders,\n    SUM(o.final_amount) as lifetime_value,\n    ROUND(AVG(DATEDIFF(o2.order_date, o1.order_date)), 2) as avg_days_between_orders,\n    CASE\n        WHEN DATEDIFF(NOW(), MAX(o.order_date)) > AVG(DATEDIFF(o2.order_date, o1.order_date)) * 2 THEN 'High Churn Risk'\n        WHEN DATEDIFF(NOW(), MAX(o.order_date)) > AVG(DATEDIFF(o2.order_date, o1.order_date)) THEN 'Medium Churn Risk'\n        ELSE 'Low Churn Risk'\n    END as churn_risk\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nLEFT JOIN orders o1 ON u.user_id = o1.user_id\nLEFT JOIN orders o2 ON u.user_id = o2.user_id AND o2.order_date > o1.order_date\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name\nHAVING total_orders > 1\nORDER BY churn_risk DESC, days_since_last_order DESC;"}
{"id": "Q79", "question": "Price elasticity analysis by category", "expected_sql": "SELECT\n    c.category_name,\n    ROUND(AVG(p.discount_percentage), 2) as avg_discount,\n    SUM(oi.quantity) as units_sold,\n    ROUND(AVG(p.selling_price), 2) as avg_selling_price,\n    ROUND(SUM(oi.total_price) / SUM(oi.quantity), 2) as revenue_per_unit\nFROM categories c\nJOIN products p ON c.category_id = p.category_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY c.category_id, c.category_name\nORDER BY units_sold DESC;"}
{"id": "Q80", "question": "Seller market share analysis", "expected_sql": "SELECT\n    s.seller_name,\n    COUNT(DISTINCT oi.order_id) as orders,\n    SUM(oi.total_price) as revenue,\n    ROUND(SUM(oi.total_price) * 100.0 / (\n        SELECT SUM(total_price)\n        FROM order_items oi2\n        JOIN orders o2 ON oi2.order_id = o2.order_id\n        WHERE o2.order_status = 'Delivered'\n    ), 2) as market_share_percent,\n    RANK() OVER (ORDER BY SUM(oi.total_price) DESC) as market_rank\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nWHERE o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name\nORDER BY market_share_percent DESC;"}
{"id": "Q81", "question": "Promotion effectiveness analysis", "expected_sql": "SELECT\n    c.coupon_code,\n    c.discount_type,\n    c.discount_value,\n    COUNT(uc.user_coupon_id) as times_used,\n    SUM(uc.discount_applied) as total_discount_given,\n    SUM(o.final_amount) as revenue_generated,\n    ROUND(SUM(o.final_amount) / SUM(uc.discount_applied), 2) as roi_ratio\nFROM coupons c\nJOIN user_coupons uc ON c.coupon_id = uc.coupon_id\nJOIN orders o ON uc.order_id = o.order_id\nWHERE o.payment_status = 'Paid'\nGROUP BY c.coupon_id, c.coupon_code, c.discount_type, c.discount_value\nORDER BY roi_ratio DESC;"}
{"id": "Q82", "question": "Geographic expansion opportunities", "expected_sql": "SELECT\n    a.state,\n    COUNT(DISTINCT a.user_id) as registered_users,\n    COUNT(DISTINCT o.order_id) as orders_placed,\n    SUM(o.final_amount) as total_revenue,\n    ROUND(COUNT(DISTINCT o.order_id) * 1.0 / COUNT(DISTINCT a.user_id), 2) as orders_per_user,\n    ROUND(SUM(o.final_amount) / COUNT(DISTINCT a.user_id), 2) as revenue_per_user\nFROM addresses a\nLEFT JOIN orders o ON a.address_id = o.shipping_address_id AND o.payment_status = 'Paid'\nGROUP BY a.state\nORDER BY revenue_per_user DESC;"}
{"id": "Q83", "question": "Product launch performance tracking", "expected_sql": "SELECT\n    p.product_name,\n    p.created_at as launch_date,\n    DATEDIFF(NOW(), p.created_at) as days_since_launch,\n    COUNT(oi.order_item_id) as times_ordered,\n    SUM(oi.quantity) as units_sold,\n    SUM(oi.total_price) as total_revenue,\n    ROUND(SUM(oi.total_price) / DATEDIFF(NOW(), p.created_at), 2) as daily_revenue_rate\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nWHERE p.created_at >= DATE_SUB(NOW(), INTERVAL 6 MONTH)\nGROUP BY p.product_id, p.product_name, p.created_at\nORDER BY daily_revenue_rate DESC;"}
{"id": "Q84", "question": "Payment failure analysis", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    payment_method,\n    COUNT(CASE WHEN payment_status = 'Failed' THEN 1 END) as failed_payments,\n    COUNT(*) as total_attempts,\n    ROUND(COUNT(CASE WHEN payment_status = 'Failed' THEN 1 END) * 100.0 / COUNT(*), 2) as failure_rate,\n    SUM(CASE WHEN payment_status = 'Failed' THEN final_amount ELSE 0 END) as lost_revenue\nFROM orders\nGROUP BY month, payment_method\nORDER BY month, failure_rate DESC;"}
{"id": "Q85", "question": "Customer acquisition channel analysis (based on signup patterns)", "expected_sql": "SELECT\n    DATE_FORMAT(created_at, '%Y-%m') as signup_month,\n    COUNT(*) as new_users,\n    COUNT(CASE WHEN email LIKE '%@gmail.%' THEN 1 END) as gmail_users,\n    COUNT(CASE WHEN email LIKE '%@yahoo.%' THEN 1 END) as yahoo_users,\n    COUNT(CASE WHEN email NOT LIKE '%@gmail.%' AND email NOT LIKE '%@yahoo.%' THEN 1 END) as other_email_users\nFROM users\nGROUP BY signup_month\nORDER BY signup_month;"}
{"id": "Q86", "question": "Inventory optimization recommendations", "expected_sql": "SELECT\n    p.product_name,\n    p.stock_quantity as current_stock,\n    COALESCE(SUM(oi.quantity), 0) as total_sold,\n    ROUND(COALESCE(SUM(oi.quantity), 0) / 6, 2) as avg_monthly_sales,\n    ROUND(p.stock_quantity / NULLIF(SUM(oi.quantity) / 6, 0), 2) as months_of_inventory,\n    CASE\n        WHEN p.stock_quantity / NULLIF(SUM(oi.quantity) / 6, 0) < 1 THEN 'Restock Urgently'\n        WHEN p.stock_quantity / NULLIF(SUM(oi.quantity) / 6, 0) < 2 THEN 'Restock Soon'\n        WHEN p.stock_quantity / NULLIF(SUM(oi.quantity) / 6, 0) > 6 THEN 'Overstock'\n        ELSE 'Optimal'\n    END as stock_status\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nWHERE p.is_active = 1\nGROUP BY p.product_id, p.product_name, p.stock_quantity\nORDER BY months_of_inventory;"}
{"id": "Q87", "question": "Brand loyalty analysis", "expected_sql": "SELECT\n    p.brand,\n    COUNT(DISTINCT o.user_id) as unique_customers,\n    COUNT(o.order_id) as total_orders,\n    ROUND(COUNT(o.order_id) * 1.0 / COUNT(DISTINCT o.user_id), 2) as repeat_purchase_rate,\n    SUM(o.final_amount) as total_revenue,\n    ROUND(AVG(r.rating), 2) as avg_rating\nFROM products p\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nLEFT JOIN reviews r ON p.product_id = r.product_id\nWHERE o.payment_status = 'Paid' AND p.brand IS NOT NULL\nGROUP BY p.brand\nHAVING total_orders > 5\nORDER BY repeat_purchase_rate DESC;"}
{"id": "Q88", "question": "Time-based purchase patterns", "expected_sql": "SELECT\n    HOUR(order_date) as hour_of_day,\n    COUNT(*) as order_count,\n    SUM(final_amount) as revenue,\n    ROUND(AVG(final_amount), 2) as avg_order_value,\n    COUNT(CASE WHEN payment_method = 'COD' THEN 1 END) as cod_orders,\n    COUNT(CASE WHEN payment_method != 'COD' THEN 1 END) as online_payment_orders\nFROM orders\nWHERE payment_status = 'Paid'\nGROUP BY hour_of_day\nORDER BY order_count DESC;"}
{"id": "Q89", "question": "Customer segment profitability", "expected_sql": "SELECT\n    segment,\n    COUNT(DISTINCT user_id) as customer_count,\n    SUM(total_orders) as total_orders,\n    SUM(total_revenue) as total_revenue,\n    ROUND(AVG(total_revenue), 2) as avg_revenue_per_customer,\n    ROUND(AVG(avg_order_value), 2) as avg_order_value\nFROM (\n    SELECT\n        u.user_id,\n        CASE\n            WHEN COUNT(o.order_id) = 1 THEN 'One-time Buyer'\n            WHEN COUNT(o.order_id) BETWEEN 2 AND 3 THEN 'Occasional Buyer'\n            WHEN COUNT(o.order_id) BETWEEN 4 AND 6 THEN 'Regular Customer'\n            ELSE 'VIP Customer'\n        END as segment,\n        COUNT(o.order_id) as total_orders,\n        SUM(o.final_amount) as total_revenue,\n        AVG(o.final_amount) as avg_order_value\n    FROM users u\n    JOIN orders o ON u.user_id = o.user_id\n    WHERE o.payment_status = 'Paid'\n    GROUP BY u.user_id\n) as customer_segments\nGROUP BY segment\nORDER BY avg_revenue_per_customer DESC;"}
{"id": "Q90", "question": "Seller diversification analysis", "expected_sql": "SELECT\n    s.seller_name,\n    COUNT(DISTINCT p.category_id) as categories_covered,\n    COUNT(DISTINCT p.product_id) as total_products,\n    SUM(oi.total_price) as total_revenue,\n    ROUND(SUM(oi.total_price) / COUNT(DISTINCT p.product_id), 2) as revenue_per_product\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nGROUP BY s.seller_id, s.seller_name\nORDER BY revenue_per_product DESC;"}
{"id": "Q91", "question": "Revenue forecasting based on trends", "expected_sql": "SELECT\n    DATE_FORMAT(order_date, '%Y-%m') as month,\n    SUM(final_amount) as actual_revenue,\n    AVG(SUM(final_amount)) OVER (ORDER BY DATE_FORMAT(order_date, '%Y-%m') ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as moving_avg_3month,\n    LAG(SUM(final_amount), 1) OVER (ORDER BY DATE_FORMAT(order_date, '%Y-%m')) as prev_month_revenue,\n    ROUND((SUM(final_amount) - LAG(SUM(final_amount), 1) OVER (ORDER BY DATE_FORMAT(order_date, '%Y-%m'))) * 100.0 /\n        LAG(SUM(final_amount), 1) OVER (ORDER BY DATE_FORMAT(order_date, '%Y-%m')), 2) as growth_rate\nFROM orders\nWHERE payment_status = 'Paid'\nGROUP BY month\nORDER BY month;"}
{"id": "Q92", "question": "Product cannibalization analysis", "expected_sql": "SELECT\n    p1.product_name as product1,\n    p2.product_name as product2,\n    p1.category_id,\n    COUNT(DISTINCT o.user_id) as shared_customers,\n    SUM(CASE WHEN oi1.order_id = oi2.order_id THEN 1 ELSE 0 END) as bought_together,\n    ABS(p1.selling_price - p2.selling_price) as price_difference\nFROM products p1\nJOIN products p2 ON p1.category_id = p2.category_id AND p1.product_id < p2.product_id\nJOIN order_items oi1 ON p1.product_id = oi1.product_id\nJOIN order_items oi2 ON p2.product_id = oi2.product_id\nJOIN orders o ON (oi1.order_id = o.order_id OR oi2.order_id = o.order_id)\nWHERE o.order_status = 'Delivered'\nGROUP BY p1.product_id, p1.product_name, p2.product_id, p2.product_name, p1.category_id, p1.selling_price, p2.selling_price\nHAVING shared_customers > 2\nORDER BY shared_customers DESC;"}
{"id": "Q93", "question": "Operational efficiency by seller", "expected_sql": "SELECT\n    s.seller_name,\n    COUNT(DISTINCT o.order_id) as total_orders,\n    ROUND(AVG(DATEDIFF(o.actual_delivery_date, o.order_date)), 2) as avg_fulfillment_days,\n    COUNT(CASE WHEN o.order_status = 'Cancelled' THEN 1 END) as cancelled_orders,\n    ROUND(COUNT(CASE WHEN o.order_status = 'Cancelled' THEN 1 END) * 100.0 / COUNT(o.order_id), 2) as cancellation_rate,\n    ROUND(AVG(r.rating), 2) as avg_rating,\n    SUM(oi.total_price) as total_revenue\nFROM sellers s\nJOIN products p ON s.seller_id = p.seller_id\nJOIN order_items oi ON p.product_id = oi.product_id\nJOIN orders o ON oi.order_id = o.order_id\nLEFT JOIN reviews r ON p.product_id = r.product_id\nGROUP BY s.seller_id, s.seller_name\nORDER BY total_revenue DESC;"}
{"id": "Q94", "question": "Customer demographic insights", "expected_sql": "SELECT\n    u.gender,\n    CASE\n        WHEN TIMESTAMPDIFF(YEAR, u.date_of_birth, CURDATE()) < 25 THEN 'Under 25'\n        WHEN TIMESTAMPDIFF(YEAR, u.date_of_birth, CURDATE()) BETWEEN 25 AND 34 THEN '25-34'\n        WHEN TIMESTAMPDIFF(YEAR, u.date_of_birth, CURDATE()) BETWEEN 35 AND 44 THEN '35-44'\n        ELSE '45+'\n    END as age_group,\n    COUNT(DISTINCT u.user_id) as customer_count,\n    COUNT(o.order_id) as total_orders,\n    SUM(o.final_amount) as total_spent,\n    ROUND(AVG(o.final_amount), 2) as avg_order_value\nFROM users u\nLEFT JOIN orders o ON u.user_id = o.user_id AND o.payment_status = 'Paid'\nWHERE u.date_of_birth IS NOT NULL\nGROUP BY u.gender, age_group\nORDER BY total_spent DESC;"}
{"id": "Q95", "question": "Product review sentiment vs sales correlation", "expected_sql": "SELECT\n    p.product_name,\n    ROUND(AVG(r.rating), 2) as avg_rating,\n    COUNT(r.review_id) as review_count,\n    SUM(oi.quantity) as units_sold,\n    SUM(oi.total_price) as total_revenue,\n    CASE\n        WHEN AVG(r.rating) >= 4.5 THEN 'Excellent'\n        WHEN AVG(r.rating) >= 4.0 THEN 'Good'\n        WHEN AVG(r.rating) >= 3.0 THEN 'Average'\n        ELSE 'Poor'\n    END as rating_category\nFROM products p\nLEFT JOIN reviews r ON p.product_id = r.product_id AND r.is_active = 1\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nGROUP BY p.product_id, p.product_name\nHAVING review_count > 0\nORDER BY total_revenue DESC;"}
{"id": "Q96", "question": "Discount strategy effectiveness", "expected_sql": "SELECT\n    CASE\n        WHEN p.discount_percentage = 0 THEN 'No Discount'\n        WHEN p.discount_percentage < 15 THEN 'Low (0-15%)'\n        WHEN p.discount_percentage < 25 THEN 'Medium (15-25%)'\n        ELSE 'High (25%+)'\n    END as discount_tier,\n    COUNT(DISTINCT p.product_id) as product_count,\n    SUM(oi.quantity) as units_sold,\n    SUM(oi.total_price) as revenue,\n    ROUND(AVG(p.discount_percentage), 2) as avg_discount,\n    ROUND(SUM(oi.total_price) / SUM(oi.quantity), 2) as avg_selling_price\nFROM products p\nLEFT JOIN order_items oi ON p.product_id = oi.product_id\nLEFT JOIN orders o ON oi.order_id = o.order_id AND o.order_status = 'Delivered'\nGROUP BY discount_tier\nORDER BY revenue DESC;"}
{"id": "Q97", "question": "Customer journey analysis", "expected_sql": "SELECT\n    u.user_id,\n    u.first_name,\n    u.last_name,\n    MIN(o.order_date) as first_order_date,\n    MAX(o.order_date) as last_order_date,\n    COUNT(o.order_id) as total_orders,\n    ROUND(DATEDIFF(MAX(o.order_date), MIN(o.order_date)) / NULLIF(COUNT(o.order_id) - 1, 0), 2) as avg_days_between_orders,\n    SUM(o.final_amount) as lifetime_value,\n    COUNT(DISTINCT oi.product_id) as unique_products_purchased,\n    COUNT(DISTINCT p.category_id) as unique_categories_purchased\nFROM users u\nJOIN orders o ON u.user_id = o.user_id\nJOIN order_items oi ON o.order_id = oi.order_id\nJOIN products p ON oi.product_id = p.product_id\nWHERE o.payment_status = 'Paid'\nGROUP BY u.user_id, u.first_name, u.last_name\nHAVING total_orders > 1\nORDER BY lifetime_value DESC\nLIMIT 20;"}
{"id": "Q98", "question": "Market basket size analysis", "expected_sql": "SELECT\n    items_per_order,\n    COUNT(*) as order_count,\n    ROUND(AVG(order_value), 2) as avg_order_value,\n    SUM(order_value) as total_revenue,\n    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM orders WHERE payment_status = 'Paid'), 2) as percentage_of_orders\nFROM (\n    SELECT\n        o.order_id,\n        COUNT(oi.order_item_id) as items_per_order,\n        o.final_amount as order_value\n    FROM orders o\n    JOIN order_items oi ON o.order_id = oi.order_id\n    WHERE o.payment_status = 'Paid'\n    GROUP BY o.order_id, o.final_amount\n) as order_items_count\nGROUP BY items_per_order\nORDER BY items_per_order;"}
{"id": "Q99", "question": "Return and refund analysis", "expected_sql": "SELECT\n    DATE_FORMAT(o.order_date, '%Y-%m') as month,\n    COUNT(CASE WHEN o.order_status = 'Returned' THEN 1 END) as returned_orders,\n    COUNT(CASE WHEN o.payment_status = 'Refunded' THEN 1 END) as refunded_orders,\n    COUNT(*) as total_orders,\n    ROUND(COUNT(CASE WHEN o.order_status = 'Returned' THEN 1 END) * 100.0 / COUNT(*), 2) as return_rate,\n    SUM(CASE WHEN o.payment_status = 'Refunded' THEN o.final_amount ELSE 0 END) as refund_amount\nFROM orders o\nGROUP BY month\nORDER BY month;"}
{"id": "Q100", "question": "Comprehensive business health dashboard", "expected_sql": "SELECT\n    'Total Revenue' as metric,\n    CONCAT('₹', FORMAT(SUM(final_amount), 2)) as value\nFROM orders WHERE payment_status = 'Paid'\nUNION ALL\nSELECT\n    'Total Orders',\n    CAST(COUNT(*) AS CHAR)\nFROM orders WHERE payment_status = 'Paid'\nUNION ALL\nSELECT\n    'Active Customers',\n    CAST(COUNT(DISTINCT user_id) AS CHAR)\nFROM orders WHERE payment_status = 'Paid'\nUNION ALL\nSELECT\n    'Average Order Value',\n    CONCAT('₹', FORMAT(AVG(final_amount), 2))\nFROM orders WHERE payment_status = 'Paid'\nUNION ALL\nSELECT\n    'Conversion Rate',\n    CONCAT(FORMAT(COUNT(DISTINCT CASE WHEN o.payment_status = 'Paid' THEN o.user_id END) * 100.0 / COUNT(DISTINCT u.user_id), 2), '%')\nFROM users u LEFT JOIN orders o ON u.user_id = o.user_id\nUNION ALL\nSELECT\n    'Total Products',\n    CAST(COUNT(*) AS CHAR)\nFROM products WHERE is_active = 1\nUNION ALL\nSELECT\n    'Average Rating',\n    CAST(ROUND(AVG(rating), 2) AS CHAR)\nFROM reviews WHERE is_active = 1\nUNION ALL\nSELECT\n    'Active Sellers',\n    CAST(COUNT(*) AS CHAR)\nFROM sellers WHERE is_active = 1\nUNION ALL\nSELECT\n    'Order Fulfillment Rate',\n    CONCAT(FORMAT(COUNT(CASE WHEN order_status = 'Delivered' THEN 1 END) * 100.0 / COUNT(*), 2), '%')\nFROM orders\nUNION ALL\nSELECT\n    'Month-over-Month Growth',\n    CONCAT(FORMAT(\n        ((SELECT SUM(final_amount) FROM orders WHERE payment_status = 'Paid' AND DATE_FORMAT(order_date, '%Y-%m') = DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 1 MONTH), '%Y-%m')) -\n         (SELECT SUM(final_amount) FROM orders WHERE payment_status = 'Paid' AND DATE_FORMAT(order_date, '%Y-%m') = DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 2 MONTH), '%Y-%m'))) * 100.0 /\n        NULLIF((SELECT SUM(final_amount) FROM orders WHERE payment_status = 'Paid' AND DATE_FORMAT(order_date, '%Y-%m') = DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 2 MONTH), '%Y-%m')), 0)\n    , 2), '%');\n-- ==========================================\n-- END OF TEST CASES\n-- ==========================================\n-- EVALUATION METRICS FOR CONFUSION MATRIX:\n-- True Positive (TP): System generates correct SQL for the question\n-- False Positive (FP): System generates incorrect SQL but executes\n-- True Negative (TN): System correctly identifies unparseable question\n-- False Negative (FN): System fails to generate SQL for valid question\n--\n-- Accuracy = (TP + TN) / (TP + TN + FP + FN)\n-- Precision = TP / (TP + FP)\n-- Recall = TP / (TP + FN)\n-- F1 Score = 2 * (Precision * Recall) / (Precision + Recall)\n-- =========================================="}
